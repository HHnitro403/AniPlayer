<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:local="using:AniPlayer.UI"
             mc:Ignorable="d" d:DesignWidth="960" d:DesignHeight="600"
             x:Class="AniPlayer.UI.PlayerPage">

    <!-- Row 0: Video fills remaining space. Row 1: Controls in their own row.
         CRITICAL: Controls MUST stay in Row 1. NativeControlHost creates a native Win32 HWND
         in Row 0 that always paints on top of managed content in the same region, regardless
         of Avalonia z-order. Moving controls into Row 0 makes them invisible/non-interactive. -->
    <Grid x:Name="RootGrid" RowDefinitions="*,Auto">

        <!-- Video area (Row 0) â€” native window lives here -->
        <Grid x:Name="VideoContainer" Grid.Row="0" Background="Black">
            <local:VideoHost x:Name="VideoHostControl"/>
            <TextBlock x:Name="PlaceholderText"
                       Text="Open a video file to start playback"
                       Foreground="#88FFFFFF"
                       FontSize="16"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"
                       TextAlignment="Center"/>

            <!-- TODO: Skip button renders behind HWND in fullscreen -->
            <Button x:Name="SkipOverlayButton"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Bottom"
                    Margin="0,0,30,20"
                    Padding="15,10"
                    Background="#CC000000"
                    Foreground="White"
                    CornerRadius="5"
                    Focusable="False"
                    IsVisible="False"
                    Click="OnSkipButtonClick">
                <Button.Styles>
                    <Style Selector="Button:pointerover /template/ ContentPresenter">
                        <Setter Property="Background" Value="#E6202020"/>
                        <Setter Property="Foreground" Value="#4CC2FF"/>
                    </Style>
                </Button.Styles>
                <StackPanel Orientation="Horizontal" Spacing="10">
                    <PathIcon Data="{StaticResource fast_forward_regular}" Width="16" Height="16"/>
                    <TextBlock x:Name="SkipButtonText" Text="Skip Intro" FontWeight="SemiBold"/>
                </StackPanel>
            </Button>
        </Grid>

        <!-- Modern Controls Bar (Row 1) â€” separate from native window, always accessible -->
        <Border x:Name="ControlsBar"
                Grid.Row="1"
                Background="#1E1E2E"
                BorderBrush="#2A2A3E"
                BorderThickness="0,1,0,0"
                Padding="20,16"
                PointerEntered="OnControlsBarPointerEntered"
                PointerExited="OnControlsBarPointerExited">
            <Grid RowDefinitions="Auto,Auto,Auto">

                <!-- Row 0: Progress Bar -->
                <Grid ColumnDefinitions="Auto,*,Auto" Margin="0,0,0,20">
                    <TextBlock x:Name="TimeCurrentText" Text="0:00"
                               Foreground="#B8B8D0" FontSize="12" FontWeight="Medium"
                               VerticalAlignment="Center" Margin="0,0,12,0"/>
                    <Slider x:Name="ProgressSlider" Grid.Column="1"
                            Minimum="0" Maximum="100" Value="0"
                            VerticalAlignment="Center"
                            Height="6"/>
                    <TextBlock x:Name="TimeTotalText" Text="0:00"
                               Foreground="#B8B8D0" FontSize="12" FontWeight="Medium"
                               VerticalAlignment="Center" Margin="12,0,0,0" Grid.Column="2"/>
                </Grid>

                <!-- Row 1: Transport Controls & Now Playing -->
                <Grid Grid.Row="1" ColumnDefinitions="Auto,*,Auto" Margin="0,0,0,16">
                    <!-- Left: Transport Buttons -->
                    <StackPanel Orientation="Horizontal" Spacing="10">
                        <Button x:Name="PlayPauseButton" Content="â–¶ Play"
                                Padding="16,8" MinWidth="90"
                                Focusable="False"
                                Click="PlayPauseButton_Click"
                                Background="#4CC2FF"
                                Foreground="White"
                                CornerRadius="6"
                                FontWeight="SemiBold"/>
                        <Button x:Name="StopButton" Content="â¹ Stop"
                                Padding="12,8"
                                Focusable="False"
                                Click="StopButton_Click"
                                Background="#3A3A4E"
                                Foreground="#E0E0F0"
                                CornerRadius="6"/>
                        <Button x:Name="NextButton" Content="â­ Next"
                                Padding="12,8" IsEnabled="False"
                                Focusable="False"
                                Click="NextButton_Click"
                                Background="#3A3A4E"
                                Foreground="#E0E0F0"
                                CornerRadius="6"/>
                    </StackPanel>

                    <!-- Center: Now Playing Info -->
                    <StackPanel Grid.Column="1" HorizontalAlignment="Center"
                                VerticalAlignment="Center">
                        <TextBlock x:Name="NowPlayingText"
                                   Text="No file loaded"
                                   Foreground="#E8E8F8" FontSize="14" FontWeight="Medium"
                                   HorizontalAlignment="Center"
                                   TextTrimming="CharacterEllipsis" MaxWidth="500"/>
                        <TextBlock x:Name="StatusText" Text="Stopped"
                                   Foreground="#8888A8" FontSize="11"
                                   HorizontalAlignment="Center" Margin="0,2,0,0"/>
                    </StackPanel>

                    <!-- Right: Fullscreen Button -->
                    <Button x:Name="FullscreenButton" Grid.Column="2"
                            Content="â›¶ Fullscreen"
                            Padding="12,8" FontSize="12"
                            Focusable="False"
                            Click="FullscreenButton_Click"
                            Background="#3A3A4E"
                            Foreground="#E0E0F0"
                            CornerRadius="6"/>
                </Grid>

                <!-- Row 2: Audio & Subtitle Track Selection -->
                <Grid Grid.Row="2" ColumnDefinitions="Auto,*,Auto,*">
                    <!-- Audio Tracks -->
                    <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                        <TextBlock Text="ðŸŽµ Audio:" Foreground="#A8A8C8"
                                   FontSize="12" FontWeight="SemiBold" VerticalAlignment="Center"/>
                        <WrapPanel x:Name="AudioTracksPanel" VerticalAlignment="Center"/>
                    </StackPanel>

                    <!-- Subtitle Tracks -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8"
                                VerticalAlignment="Center" Margin="20,0,0,0">
                        <TextBlock Text="ðŸ’¬ Subtitles:" Foreground="#A8A8C8"
                                   FontSize="12" FontWeight="SemiBold" VerticalAlignment="Center"/>
                        <WrapPanel x:Name="SubtitleTracksPanel" VerticalAlignment="Center"/>
                    </StackPanel>
                </Grid>

            </Grid>
        </Border>
    </Grid>
</UserControl>
